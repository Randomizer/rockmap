<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RockMap API Test â€“ Interaktiv</title>
    <style>
        body { font-family: sans-serif; padding: 2em; background: #f4f4f4; }
        input, button { padding: 0.5em; font-size: 1em; }
        #band-info { margin-top: 2em; background: #fff; padding: 1em; border-radius: 6px; }
        img { max-width: 200px; display: block; margin-top: 1em; }
        pre { background: #eef; padding: 1em; border-radius: 6px; overflow-x: auto; margin-top: 2em; }
        h2 { margin-top: 1em; }
    </style>
</head>
<body>
    <h1>RockMap API Test</h1>
    <label for="bandInput">Band name:</label>
    <input type="text" id="bandInput" value="The Killers">
    <button onclick="loadData()">Fetch data</button>

    <div id="band-info" style="display:none;">
        <h2 id="band-name"></h2>
        <img id="band-image" src="" alt="" />
        <p id="band-bio"></p>
        <p><strong>ðŸŽ¤ Next gig:</strong><br><span id="next-gig"></span></p>
        <p><a id="spotify-link" href="#" target="_blank">Open in Spotify</a></p>
    </div>

    <pre id="output">No data yet.</pre>

    <script>
        async function loadData() {
            const bandName = document.getElementById("bandInput").value.trim();
            if (!bandName) return;

            document.getElementById("band-info").style.display = "none";
            document.getElementById("output").textContent = "Fetching data...";

            const bandData = {
                name: bandName,
                image: null,
                bio: null,
                spotify: `https://open.spotify.com/search/${encodeURIComponent(bandName)}`,
                events: []
            };

            // Fetch Bandsintown
            try {
                const biUrl = `https://rest.bandsintown.com/artists/${encodeURIComponent(bandName)}/events?app_id=rockmap`;
                const biRes = await fetch(biUrl);
                const biData = await biRes.json();
                bandData.events = biData.map(e => ({
                    date: e.datetime,
                    venue: e.venue.name,
                    city: e.venue.city,
                    country: e.venue.country,
                    latitude: e.venue.latitude,
                    longitude: e.venue.longitude
                }));
            } catch (err) {
                console.warn("Bandsintown error:", err);
            }

            // Fetch Last.fm
            try {
                const lastfmKey = "b25b959554ed76058ac220b7b2e0a026";
                const lastfmUrl = `https://ws.audioscrobbler.com/2.0/?method=artist.getinfo&artist=${encodeURIComponent(bandName)}&api_key=${lastfmKey}&format=json`;
                const res = await fetch(lastfmUrl);
                const data = await res.json();
                if (data.artist) {
                    bandData.image = data.artist.image?.pop()["#text"] || null;
                    bandData.bio = data.artist.bio?.summary || null;
                }
            } catch (err) {
                console.warn("Last.fm error:", err);
            }

            // Update UI
            document.getElementById("band-info").style.display = "block";
            document.getElementById("band-name").textContent = bandData.name;
            document.getElementById("band-bio").innerHTML = bandData.bio || "(No biography found)";
            document.getElementById("band-image").src = bandData.image || "";
            document.getElementById("band-image").alt = bandData.name;
            document.getElementById("spotify-link").href = bandData.spotify;

            const nextGigElement = document.getElementById("next-gig");
            if (bandData.events.length > 0) {
                const next = bandData.events[0];
                const date = new Date(next.date).toLocaleDateString(undefined, {
                    year: 'numeric', month: 'short', day: 'numeric'
                });
                nextGigElement.textContent = `${date} â€“ ${next.city}, ${next.country}`;
            } else {
                nextGigElement.textContent = "No information about upcoming gigs";
            }

            document.getElementById("output").textContent = JSON.stringify(bandData, null, 2);
        }

        loadData();
    </script>
</body>
</html>